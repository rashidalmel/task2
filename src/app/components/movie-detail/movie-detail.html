<!-- Loading Section -->
<div class="loading-section" *ngIf="isLoading">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <p-progressSpinner 
          [style]="{width: '4rem', height: '4rem'}" 
          strokeWidth="4"
          fill="var(--surface-ground)" 
          animationDuration=".5s">
        </p-progressSpinner>
        <h4 class="mt-3">Loading Movie Details...</h4>
        <p class="text-muted">Fetching the latest information from TMDB</p>
        
        <!-- Progressive Loading Indicators -->
        <div class="loading-progress mt-4">
          <div class="progress-item" [class.completed]="!isLoadingDetails">
            <i class="pi" [class.pi-spinner]="isLoadingDetails" [class.pi-check]="!isLoadingDetails"></i>
            <span class="ms-2">Movie Details</span>
          </div>
          <div class="progress-item" [class.completed]="!isLoadingCredits">
            <i class="pi" [class.pi-spinner]="isLoadingCredits" [class.pi-check]="!isLoadingCredits"></i>
            <span class="ms-2">Cast & Crew</span>
          </div>
          <div class="progress-item" [class.completed]="!isLoadingVideos">
            <i class="pi" [class.pi-spinner]="isLoadingVideos" [class.pi-check]="!isLoadingVideos"></i>
            <span class="ms-2">Trailers & Videos</span>
          </div>
        </div>
        
        <div class="loading-tips mt-4">
          <small class="text-muted">
            <i class="pi pi-lightbulb me-1"></i>
            Tip: This usually takes 2-5 seconds depending on your connection
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error Section -->
<div class="error-section" *ngIf="error && !isLoading">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          {{ error }}
        </div>
        <button class="btn btn-primary" (click)="goBack()">
          <i class="fas fa-home me-2"></i>Back to Home
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Skeleton Loading Section -->
<div class="skeleton-loading" *ngIf="isLoadingDetails && !isLoading">
  <div class="container">
    <div class="row">
      <!-- Poster Skeleton -->
      <div class="col-md-4">
        <div class="skeleton-poster"></div>
      </div>
      <!-- Content Skeleton -->
      <div class="col-md-8">
        <div class="skeleton-title"></div>
        <div class="skeleton-meta"></div>
        <div class="skeleton-overview"></div>
        <div class="skeleton-overview short"></div>
        <div class="skeleton-buttons"></div>
      </div>
    </div>
  </div>
</div>

<!-- Movie Details Section -->
<div class="movie-detail-section" *ngIf="movie && !isLoading">
  <!-- Hero Section with Backdrop -->
  <div class="hero-backdrop" 
       [style.background-image]="'url(' + getCustomBackgroundUrl() + ')'">
    <div class="backdrop-overlay">
      <div class="container">
        <div class="row align-items-center min-vh-50">
          <div class="col-lg-6">
            <div class="hero-content">
              <h1 class="hero-title">{{ movie.title }}</h1>
              <p class="hero-tagline" *ngIf="movie.tagline">{{ movie.tagline }}</p>
              <div class="hero-buttons">
                <button class="btn btn-primary btn-lg me-3">
                  <i class="fas fa-play me-2"></i>Watch Trailer
                </button>
                <button class="btn btn-outline-light btn-lg">
                  <i class="fas fa-heart me-2"></i>Add to Favorites
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/home">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ movie.title }}</li>
      </ol>
    </nav>

    <div class="row">
      <!-- Poster Column -->
      <div class="col-md-4">
        <div class="poster-container">
          <img [src]="getPosterUrl(movie.poster_path)" 
               class="img-fluid rounded shadow-lg" 
               [alt]="movie.title"
               (error)="$event.target.src = getCastProfileUrl(null)">
        </div>
      </div>

      <!-- Details Column -->
      <div class="col-md-8">
        <div class="movie-info">
          <h1 class="movie-title">{{ movie.title }}</h1>
          
          <!-- Rating and Basic Info -->
          <div class="movie-meta mb-3">
            <span class="badge bg-warning text-dark me-2">
              <i class="fas fa-star me-1"></i>{{ movie.vote_average.toFixed(1) }}/10
            </span>
                         <span class="badge bg-info me-2">{{ getReleaseYear(movie.release_date) }}</span>
            <span class="badge bg-secondary me-2" *ngIf="movie.runtime">{{ formatRuntime(movie.runtime) }}</span>
            <span class="badge bg-success me-2" *ngIf="movie.status">{{ movie.status }}</span>
          </div>

          <!-- Genres -->
          <div class="genres mb-3" *ngIf="movie.genres">
            <span class="badge bg-outline-secondary me-1" *ngFor="let genre of movie.genres">
              {{ genre.name }}
            </span>
          </div>

          <!-- Overview -->
          <div class="overview mb-4">
            <h5>Overview</h5>
            <p class="lead">{{ movie.overview || 'No overview available.' }}</p>
          </div>

          <!-- Additional Details -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h6><i class="fas fa-user me-2"></i>Director</h6>
              <p class="text-muted">{{ getDirector() }}</p>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-calendar me-2"></i>Release Date</h6>
                             <p class="text-muted">{{ formatReleaseDate(movie.release_date) }}</p>
            </div>
          </div>

          <!-- Financial Info -->
          <div class="financial-info mb-4" *ngIf="movie.budget > 0 || movie.revenue > 0">
            <h6><i class="fas fa-dollar-sign me-2"></i>Financial Information</h6>
            <div class="row">
              <div class="col-md-6">
                <small class="text-muted">Budget</small>
                <p class="mb-1">{{ formatCurrency(movie.budget) }}</p>
              </div>
              <div class="col-md-6">
                <small class="text-muted">Revenue</small>
                <p class="mb-1">{{ formatCurrency(movie.revenue) }}</p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="btn btn-primary btn-lg me-3">
              <i class="fas fa-play me-2"></i>Watch Now
            </button>
            <button class="btn btn-outline-secondary btn-lg me-3">
              <i class="fas fa-heart me-2"></i>Add to Favorites
            </button>
            <button class="btn btn-outline-info btn-lg">
              <i class="fas fa-share me-2"></i>Share
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Trailer Section -->
    <div class="trailer-section mt-5" *ngIf="getTrailerUrl()">
      <h3 class="section-title">
        <i class="fas fa-play-circle me-2"></i>Official Trailer
      </h3>
      <div class="trailer-container">
        <div class="ratio ratio-16x9">
          <iframe [src]="getTrailerUrl()" 
                  title="Movie Trailer" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
          </iframe>
        </div>
      </div>
    </div>

    <!-- Cast Section -->
    <div class="cast-section mt-5" *ngIf="getTopCast().length > 0">
      <h3 class="section-title">
        <i class="fas fa-users me-2"></i>Top Cast
      </h3>
      <div class="cast-grid">
        <div class="cast-member" *ngFor="let member of getTopCast()">
          <div class="cast-avatar">
            <img [src]="getCastProfileUrl(member.profile_path)" 
                 [alt]="member.name"
                 class="img-fluid rounded"
                 (error)="$event.target.src = getCastProfileUrl(null)">
          </div>
          <div class="cast-info">
            <h6 class="cast-name">{{ member.name }}</h6>
            <p class="cast-character">{{ member.character }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
